type: object
properties:
  root:
    type: object
    properties:
      email: { type: string, format: email }
      password: { type: ["null", string] }

    additionalProperties: false
    required: [email, password]

  frontend:
    type: object
    properties:
      maxParallelCallsPerClient:
        anyOf:
          - type: "null"
          - { type: integer, minimum: 1 }
      maxApiRequestLength: { type: integer, minimum: 1 }
      maxUploadFileSize: { type: integer, minimum: 1 }
      idleTimeout: { type: integer, minimum: 0 }
      sendPingsAutomatically: { type: boolean }
      compress:
        anyOf:
          - type: "null" # use server default
          - type: boolean
          - { type: integer, minimum: 0 }

    additionalProperties: false
    required: [maxParallelCallsPerClient, maxApiRequestLength, maxUploadFileSize, idleTimeout, sendPingsAutomatically, compress]

  frontendUrl: { type: string, format: uri }
  passwordsStrength: { enum: [weak, normal, strong] }
  signupEnabled: { typs: boolean }
  newUserEnabledByDefault: { typs: boolean } # new users are enabled by default

  tokensCacheMaxSize: { type: integer, minimum: 1 }
  sessionsCacheMaxSize: { type: integer, minimum: 1 }

  tokenLength: { type: integer, minimum: 6 }
  sessionTokenLength: { type: integer, minimum: 6 }

  sessionMaxAge: { type: integer, minimum: 60_000 } # ms
  authorizedSessionMaxAge: { type: integer, minimum: 60_000 } # ms
  aclCacheMaxSize: { type: integer, minimum: 0 }

  oauth:
    type: object
    properties:
      google:
        anyOf:
          - type: "null"
          - type: object
            properties:
              clientId: { type: ["null", string] }
              clientSecret: { type: ["null", string] }
            additionalProperties: false
            required: [clientId, clientSecret]

      facebook:
        anyOf:
          - type: "null"
          - type: object
            properties:
              clientId: { type: ["null", string] }
              clientSecret: { type: ["null", string] }
            additionalProperties: false
            required: [clientId, clientSecret]

      github:
        anyOf:
          - type: "null"
          - type: object
            properties:
              clientId: { type: ["null", string] }
              clientSecret: { type: ["null", string] }
            required: [clientId, clientSecret]
            additionalProperties: false

    additionalProperties: false
    required: [google, facebook, github]

  acl:
    type: object
    propertyNames: { type: string, format: kebab-case }
    additionalProperties:
      type: object
      propertyNames: { type: string, format: kebab-case }
      additionalProperties:
        type: object
        properties:
          name: { type: string }
          description: { type: string }
          permissions: { type: array, items: { type: string }, minItems: 1, uniqueItems: true }
        required: [name, description, permissions]
      minProperties: 1 # at least 1 role is required
    minProperties: 1 # at least 1 acl type is required

additionalProperties: false
required:
  - root
  - frontend

  - frontendUrl
  - passwordsStrength
  - signupEnabled
  - newUserEnabledByDefault

  - tokensCacheMaxSize
  - sessionsCacheMaxSize

  - tokenLength
  - sessionTokenLength

  - sessionMaxAge
  - authorizedSessionMaxAge
  - aclCacheMaxSize

  - oauth

  - acl
