- $id: config
  type: object
  properties:
    # root user
    root:
      type: object
      properties:
        email: { type: string, format: email }
        password: { type: ["null", string] }

      additionalProperties: false
      required: [email, password]

    avatarUrl: { type: string, formal: kebab-case-absolute-folder-path }
    avatarMaxAge: { type: string, format: duration }
    forceDefaultAvatar: { type: boolean }
    defaultGravatar:
      anyOf:
        - type: "null"
        - enum: [mp, identicon, monsterid, wavatar, retro, robohash]

    # frontend
    frontendUrl: { type: string, format: uri }
    frontend:
      type: object
      properties:
        maxParallelCallsPerClient:
          anyOf:
            - type: "null"
            - { type: integer, minimum: 1 }
        maxApiRequestLength: { type: integer, minimum: 1 }
        maxUploadFileSize: { type: integer, minimum: 1 }
        idleTimeout: { type: integer, minimum: 0 }
        sendPingsAutomatically: { type: boolean }
        compress:
          anyOf:
            - type: "null" # use server default
            - type: boolean
            - { type: integer, minimum: 0 }

      additionalProperties: false
      required: [maxParallelCallsPerClient, maxApiRequestLength, maxUploadFileSize, idleTimeout, sendPingsAutomatically, compress]

    # users
    signupEnabled: { typs: boolean }

    # tokens
    apiTokensCacheMaxSize: { type: integer, minimum: 1 }

    # sessions
    sessionsCacheMaxSize: { type: integer, minimum: 1 }
    sessionMaxAge: { type: string, format: duration } # ms
    authorizedSessionMaxAge: { type: string, format: duration } # ms

    # oauth
    oauth:
      type: object
      properties:
        google:
          anyOf:
            - type: "null"
            - type: object
              properties:
                clientId: { type: ["null", string] }
                clientSecret: { type: ["null", string] }
              additionalProperties: false
              required: [clientId, clientSecret]

        facebook:
          anyOf:
            - type: "null"
            - type: object
              properties:
                clientId: { type: ["null", string] }
                clientSecret: { type: ["null", string] }
              additionalProperties: false
              required: [clientId, clientSecret]

        github:
          anyOf:
            - type: "null"
            - type: object
              properties:
                clientId: { type: ["null", string] }
                clientSecret: { type: ["null", string] }
              required: [clientId, clientSecret]
              additionalProperties: false

      additionalProperties: false
      required: [google, facebook, github]

  additionalProperties: false
  required:
    - root

    - avatarUrl
    - avatarMaxAge
    - forceDefaultAvatar

    - frontendUrl
    - frontend

    - signupEnabled

    - apiTokensCacheMaxSize

    - sessionsCacheMaxSize
    - sessionMaxAge
    - authorizedSessionMaxAge

    - oauth
