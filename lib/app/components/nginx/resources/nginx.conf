daemon                       off;
worker_processes             auto;
pcre_jit                     on;
pid                          "<%- baseDir %>/nginx.pid";

events {
    worker_connections       8192;
}

http {
    server_tokens            off;

    default_type             "application/octet-stream";

    log_format               default "$time_local\t$remote_addr\t$status\t$body_bytes_sent\t$request";
    error_log                stderr crit;
    log_not_found            off;
    access_log               off;

    sendfile                 on;
    # aio                      on;
    # directio                 512;
    output_buffers           1 128K;

<% if ( cacheEnabled ) { -%>
    proxy_cache_path         "<%- cacheDir %>"
                             levels=1:2
                             keys_zone=default:10M
<% if ( cacheMaxSize ) { -%>
                             <%- "max_size=" + cacheMaxSize %>
<% } -%>
<% if ( cacheMinFree ) { -%>
                             <%- "min_free=" + cacheMinFree %>
<% } -%>
                             inactive=<%- cacheInactive %>
                             use_temp_path=off;
<% } -%>
    # XXX ???
    proxy_buffers            64 32K;
    proxy_buffer_size        32K;

    map $http_connection $proxy_connection {
        default          "";
        "upgrade"        "upgrade";
    }

    # http servers
    include                  "<%- configsDir %>/*.http.nginx.conf";
}

stream {

    # stream servers
    include                  "<%- configsDir %>/*.stream.nginx.conf";
}
