upstream "<%- id %>" {
    zone                    "<%- id %>"
                            1M;
    least_conn;

<% for ( const upstream of upstreams ) { -%>
    server                  <%- upstream %>;
<% } -%>
}

server {
<% if ( !listenIpFamily || listenIpFamily === 4 ) { -%>
    listen                  *:<%- port %>;
<% } -%>
<% if ( !listenIpFamily || listenIpFamily === 6 ) { -%>
    listen                  [::]:<%- port %>;
<% } -%>

<% if ( sslCertificate ) { -%>
    listen                  "unix:<%- unixSocketsPath %>/http-443.socket" ssl proxy_protocol;

    ssl_certificate         "<%- sslCertificate %>";
    ssl_certificate_key     "<%- sslCertificateKey %>";
<% } -%>

    proxy_pass              "<%- id %>";

    # proxy_socket_keepalive   on;
    # proxy_connect_timeout    20s;
    # proxy_timeout            10M;
}
