server {
<% if ( server.port === 443 ) { -%>
    listen                  "unix:<%- unixSocketsPath %>/<%- id %>.443.socket" ssl proxy_protocol;
<% } else { -%>
<% if ( !listenIpFamily || listenIpFamily === 4 ) { -%>
    listen                  *:<%- server.poer %><%- server.sslEnabled ? " ssl" : "" %><%- server.isUdp ? " udp" : "" %><%- server.proxyProtocol ? " proxy_protocol" : "" %>;
<% } -%>
<% if ( !listenIpFamily || listenIpFamily === 6 ) { -%>
    listen                  [::]:<%- server.port %><%- server.sslEnabled ? " ssl" : "" %><%- server.isUdp ? " udp" : "" %><%- server.proxyProtocol ? " proxy_protocol" : "" %>;
<% } -%>
<% } -%>
<% if ( server.sslEnabled ) { -%>

    ssl_certificate         "<%- server.ssl.certificate %>";
    ssl_certificate_key     "<%- server.ssl.certificateKey %>";
<% } -%>

    proxy_pass              "<%- upstream.id %>";

    proxy_protocol          <%- upstream.proxyProtocol ? "on" : "off" %>;
}
