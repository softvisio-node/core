upstream "<%- upstream.id %>" {
    zone                    "<%- upstream.id %>"
                            1M;
    least_conn;
    keepalive               512; # max. number of non-active upstream connections
    keepalive_timeout       180s;

<% if ( upstream.hasUpstreams ) { -%>
<% for ( const server of upstream.upstreams ) { -%>
    server                  "<%- server %>";
<% } -%>
<% } else { -%>
    server                  unix:/dev/null down;
<% } -%>
}
