upstream "<%- upstream.id %>" {
    zone                    "<%- upstream.id %>"
                            1M;
    least_conn;
    keepalive               512; # max. number of non-active upstream connections
    keepalive_timeout       180s;

<% if ( upstream.hasUpstreams ) { -%>
<% for ( const upstream of upstream.upstreams ) { -%>
    server                  "<%- upstream %>";
<% } -%>
<% } else { -%>
    server                  unix:/dev/null down;
<% } -%>
}
