<% for ( const port of streamPorts ) { -%>
upstream <%- id %>-<%- port %> {
    zone                     upstream-zone-<%- id %>-<%- port %> 1m;
    least_conn;
    server                   0.0.0.0:1 down;
    # server                   <%- upstreamServer %>;
    # dns_update               30s;
    # dns_ipv6                 off;
}

server {
<% if ( !listenIpFamily || listenIpFamily === 4 ) { -%>
    listen                   *:<%- port %>;
<% } -%>
<% if ( !listenIpFamily || listenIpFamily === 6 ) { -%>
    listen                   [::]:<%- port %>;
<% } -%>
    proxy_pass               <%- id %>-<%- port %>;
    proxy_socket_keepalive   on;
    proxy_connect_timeout    20s;
    proxy_timeout            10m;
}

<% } -%>
