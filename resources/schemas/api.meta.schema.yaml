# module
- $id: module
  type: object
  properties:
    title: { $ref: "components#/titleString" }
    description: { $ref: "components#/desc" }
    extends: { type: string }
    permissions: { $ref: "components#/permissions" }

    methods:
      type: object
      additionalProperties:
        type: object
        properties:
          title: { $ref: "components#/titleString" }
          description: { $ref: "components#/desc" }
          deprecated: { type: boolean }
          private: { type: boolean }
          permissions: { $ref: "components#/permissions" }
          persistentConnectionRequired: { type: "boolean" }
          validateParams: { type: "boolean" }
          logApiCalls: { type: boolean }
          activeRequestsLimit: { type: integer, minimum: 0 }
          activeRequestsUserLimit: { type: integer, minimum: 0 }
          params:
            params:
            type: array
            minItems: 1
            items:
              type: object
              properties:
                name: { type: string }
                description: { $ref: "components#/desc" }
                required: { type: boolean }
                schema: { type: object }
              required: [name, schema]
              additionalProperties: false
          meta:
            anyOf:
              - type: object
                properties:
                  type: { const: upload }
                  uploadMaxSize: { type: integer, minimum: 1 }
                  uploadContentType:
                    anyOf:
                      - type: string
                      - type: array
                        minItems: 1
                        items: { type: string }
                required: [type, uploadMaxSize]
                additionalProperties: false
              - type: object
                properties:
                  type: { const: read }
                  readMaxLimit: { type: integer, minimum: 0 }
                  readDefaultLimit: { type: integer, minimum: 0 }
                  readDefaultOrderBy:
                    type: array
                    minItems: 1
                    items:
                      type: array
                      items:
                        - type: string
                        - { type: string, enum: [asc, desc] }
                required: [type]
                additionalProperties: false
        required: [title]
        additionalProperties: false

  required: [title]
  additionalProperties: false

# shared components
- $id: components
  titleString:
    type: string

  desc:
    type: string

  permissions:
    type: array
    items:
      type: string
      pattern: "^(?:[*]|[a-z-]+)$"
    minItems: 1
