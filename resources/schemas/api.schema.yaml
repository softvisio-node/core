# index
- $id: index
  type: object
  properties:
    emits:
      anyOf:
        - type: "null"
        - { type: array, items: [{ const: "*" }] }
        - { type: array, items: { type: string, format: kebab-case-path }, uniqueItems: true }
  additionalProperties: false

# module
- $id: module
  type: object
  properties:
    title: { $ref: "components#/titleText" }
    description: { $ref: "components#/descriptionText" }
    roles: { $ref: "components#/roles" }
    emits:
      anyOf:
        - type: "null"
        - { type: array, items: { type: string, format: kebab-case-path }, uniqueItems: true }

    methods:
      type: object
      additionalProperties:
        type: object
        properties:
          title: { $ref: "components#/titleText" }
          description: { $ref: "components#/descriptionText" }
          deprecated: { type: boolean }
          permission: { type: ["null", string] }
          roles: { $ref: "components#/roles" }
          authorizationRequired: { type: "boolean" }
          persistentConnectionRequired: { type: "boolean" }
          logApiCalls: { type: boolean }
          activeRequestsLimit:
            anyOf:
              - type: "null"
              - { type: integer, minimum: 1 }
          activeRequestsUserLimit:
            anyOf:
              - type: "null"
              - { type: integer, minimum: 1 }
          params:
            type: array
            minItems: 1
            items:
              type: object
              properties:
                name: { type: string, format: snake-case }
                description: { $ref: "components#/descriptionText" }
                required: { type: boolean }
                schema: { type: object }
              required: [name, schema]
              additionalProperties: false
        required: [title]
        additionalProperties: false

  required: [title]
  additionalProperties: false

# shared components
- $id: components
  titleText:
    type: string

  descriptionText:
    type: string

  roles:
    anyOf:
      - type: array
        items: [{ const: "*" }]
      - type: array
        items: { type: string, format: kebab-case }
        minItems: 1
        uniqueItems: true
